<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متتبع الشحنات - Alva Tracker</title>
    <meta name="description" content="تتبع شحنات Intigo الخاصة بك في الوقت الفعلي">
    <style>
        :root {
            --primary-color: #4f46e5;
            --primary-hover: #4338ca;
            --success-color: #10b981;
            --error-color: #ef4444;
            --text-color: #1f2937;
            --light-text: #6b7280;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', 'Segoe UI', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem 0;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
            font-weight: 700;
        }

        header p {
            color: var(--light-text);
            font-size: 1.125rem;
        }

        /* ... (Keep all your existing CSS styles) ... */

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            header h1 {
                font-size: 2rem;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>متتبع الشحنات</h1>
            <p>تتبع شحنتك مع Intigo في الوقت الحقيقي</p>
        </header>

        <main>
            <section class="search-container card">
                <form id="tracking-form">
                    <div class="form-group">
                        <label for="tracking-number">رقم التتبع (NID أو CID)</label>
                        <input 
                            type="text" 
                            id="tracking-number" 
                            placeholder="مثال: 12345 أو CLIENT123"
                            required
                            autocomplete="off"
                            autofocus
                        >
                    </div>
                    <div class="button-container">
                        <button type="submit" id="track-button">
                            <span>تتبع الشحنة</span>
                        </button>
                    </div>
                    <div class="error-message" id="error-message"></div>
                </form>
            </section>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>جاري البحث عن معلومات الشحنة...</p>
            </div>

            <section class="tracking-result card" id="tracking-result">
                <div class="result-header">
                    <h2>تفاصيل التتبع</h2>
                    <span class="tracking-number" id="result-tracking-number"></span>
                </div>

                <div class="status-container">
                    <span class="status" id="status"></span>
                </div>

                <div class="details-grid">
                    <div class="detail-item">
                        <h4>الموقع الحالي</h4>
                        <p id="location">-</p>
                    </div>
                    <div class="detail-item">
                        <h4>آخر تحديث</h4>
                        <p id="last-update">-</p>
                    </div>
                    <div class="detail-item">
                        <h4>شركة الشحن</h4>
                        <p id="carrier">-</p>
                    </div>
                    <div class="detail-item">
                        <h4>الحالة</h4>
                        <p id="status-text">-</p>
                    </div>
                </div>

                <div class="timeline" id="timeline">
                    <div class="timeline-header">سجل التتبع</div>
                    <!-- سيتم إضافة الأحداث هنا -->
                </div>
            </section>
        </main>

        <footer>
            <p>© 2023 Alva Tracker - www.alvatracker.site</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const trackingForm = document.getElementById('tracking-form');
            const trackingNumberInput = document.getElementById('tracking-number');
            const trackButton = document.getElementById('track-button');
            const errorMessage = document.getElementById('error-message');
            const loading = document.getElementById('loading');
            const trackingResult = document.getElementById('tracking-result');
            
            // Result elements
            const resultTrackingNumber = document.getElementById('result-tracking-number');
            const statusElement = document.getElementById('status');
            const locationElement = document.getElementById('location');
            const lastUpdateElement = document.getElementById('last-update');
            const carrierElement = document.getElementById('carrier');
            const statusTextElement = document.getElementById('status-text');
            const timelineElement = document.getElementById('timeline');

            // Form submission handler
            trackingForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const trackingNumber = trackingNumberInput.value.trim();
                
                if (!trackingNumber) {
                    showError('الرجاء إدخال رقم التتبع');
                    return;
                }

                clearResults();
                loading.classList.add('show');
                trackButton.disabled = true;
                
                try {
                    // Call your Vercel backend API
                    const response = await fetch(`https://www.alvatracker.site/api/track?trackingNumber=${encodeURIComponent(trackingNumber)}`);
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'فشل في جلب البيانات');
                    }
                    
                    const data = await response.json();
                    displayTrackingResults(trackingNumber, data);
                    
                    // Smooth scroll to results
                    setTimeout(() => {
                        trackingResult.scrollIntoView({ behavior: 'smooth' });
                    }, 100);
                    
                } catch (error) {
                    showError(error.message || 'حدث خطأ، الرجاء المحاولة لاحقاً');
                    console.error('Tracking error:', error);
                } finally {
                    loading.classList.remove('show');
                    trackButton.disabled = false;
                }
            });

            function displayTrackingResults(trackingNumber, data) {
                trackingResult.classList.add('show');
                resultTrackingNumber.textContent = trackingNumber;
                
                // Set status
                statusElement.textContent = data.status;
                statusTextElement.textContent = data.status;
                
                // Apply status class
                statusElement.className = 'status';
                if (data.status.includes('تم التسليم')) {
                    statusElement.classList.add('delivered');
                } else if (data.status.includes('في طريق التوصيل')) {
                    statusElement.classList.add('out-for-delivery');
                } else if (data.status.includes('في الطريق') || data.status.includes('تم نقله')) {
                    statusElement.classList.add('in-transit');
                } else {
                    statusElement.classList.add('pending');
                }
                
                // Set other details
                locationElement.textContent = data.currentLocation || 'غير معروف';
                lastUpdateElement.textContent = formatDate(data.lastUpdate) || 'غير متوفر';
                carrierElement.textContent = data.carrier || 'Intigo';
                
                // Generate timeline
                generateTimeline(data.events || []);
            }

            function generateTimeline(events) {
                timelineElement.innerHTML = '<div class="timeline-header">سجل التتبع</div>';
                
                if (events.length === 0) {
                    const noEvents = document.createElement('p');
                    noEvents.textContent = 'لا توجد أحداث تتبع متاحة';
                    noEvents.style.padding = '1rem 0';
                    noEvents.style.color = 'var(--light-text)';
                    timelineElement.appendChild(noEvents);
                    return;
                }
                
                events.forEach((event, index) => {
                    const item = document.createElement('div');
                    item.className = `timeline-item ${index === 0 ? 'current' : ''}`;
                    item.innerHTML = `
                        <div class="timeline-dot"></div>
                        <div class="timeline-date">${formatDate(event.timestamp)}</div>
                        <div class="timeline-content">
                            <h4>${event.status}</h4>
                            <p>${event.location || ''}</p>
                        </div>
                    `;
                    timelineElement.appendChild(item);
                });
            }

            function formatDate(dateString) {
                if (!dateString) return '';
                try {
                    const date = new Date(dateString);
                    return date.toLocaleString('ar-TN', {
                        day: 'numeric',
                        month: 'short',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch {
                    return dateString;
                }
            }

            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.classList.add('show');
            }

            function clearResults() {
                trackingResult.classList.remove('show');
                errorMessage.classList.remove('show');
            }
        });
    </script>
</body>
</html>